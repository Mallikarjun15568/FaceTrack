<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}FaceTrack {% endblock %}</title>

  <link rel="icon" type="image/png" href="{{ url_for('favicon') }}">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="/static/css/output.css">
  <link rel="stylesheet" href="/static/css/professional.css">
  <link rel="stylesheet" href="/static/css/premium.css">

  <!-- Icons: prefer local copy (if available), otherwise use CDN -->
  {% if FA_LOCAL_AVAILABLE %}
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/css/all.min.css') }}">
  {% else %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  {% endif %}
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Alerts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  {% block head %}{% endblock %}
</head>

<body class="bg-gray-50 text-gray-900 antialiased">

<!-- Mobile Menu Toggle -->
<button id="mobileMenuBtn" class="lg:hidden fixed top-4 left-4 z-50 w-11 h-11 bg-indigo-600 rounded-lg shadow-lg flex items-center justify-center text-white hover:bg-indigo-700 transition-colors">
  <i class="fas fa-bars text-lg"></i>
</button>

<div id="app" class="flex h-screen overflow-hidden">

  <!-- SIDEBAR -->
  <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 shadow-sm fixed lg:static inset-y-0 left-0 z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
    <div class="p-6 border-b border-gray-200">
      <a href="/" class="flex items-center gap-3 group">
        <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center shadow-sm group-hover:shadow-md transition-shadow">
          <i class="fas fa-fingerprint text-white text-xl"></i>
        </div>
        <div>
          <div class="font-bold text-lg text-gray-900">FaceTrack</div>
          <div class="text-xs text-gray-500">AI Attendance</div>
        </div>
      </a>
    </div>

    <nav class="px-3 pb-6 pt-4 overflow-y-auto h-[calc(100vh-88px)]">
      <ul class="space-y-1">

        {% if session.role in ['admin', 'hr'] %}
        <li>
          <a href="/dashboard" class="nav-link {% if request.endpoint == 'dashboard.index' %}active{% endif %}">
            <i data-feather="grid"></i>
            <span class="text-sm font-medium">Dashboard</span>
          </a>
        </li>
        {% endif %}

        <!-- Admin & HR only -->
        {% if session.role in ['admin', 'hr'] %}
        <li>
          <a href="/employees" class="nav-link {% if 'employees' in request.endpoint %}active{% endif %}">
            <i data-feather="users"></i>
            <span class="text-sm font-medium">Employees</span>
          </a>
        </li>

        <li>
          <a href="/enroll" class="nav-link {% if 'enroll' in request.endpoint %}active{% endif %}">
            <i data-feather="camera"></i>
            <span class="text-sm font-medium">Enroll Face</span>
          </a>
        </li>
        {% endif %}

        {% if session.role in ['admin', 'hr'] %}
        <li>
          <a href="/kiosk" class="nav-link {% if 'kiosk' in request.endpoint or 'recognition' in request.endpoint %}active{% endif %}">
          <i data-feather="monitor"></i>
          <span class="text-sm font-medium">Kiosk Mode</span>
         </a>
        </li>
        {% endif %}

        <li>
          <a href="/attendance" class="nav-link {% if 'attendance' in request.endpoint %}active{% endif %}">
            <i data-feather="check-circle"></i>
            <span class="text-sm font-medium">Attendance</span>
          </a>
        </li>

        <li>
          <a href="{{ url_for('leave.index') }}"
             class="nav-link {% if 'leave' in request.endpoint %}active{% endif %}">
            <i data-feather="calendar"></i>
            <span class="text-sm font-medium">Leave Management</span>
          </a>
        </li>

        <!-- Admin & HR only -->
        {% if session.role in ['admin', 'hr'] %}
        <li>
          <a href="/reports" class="nav-link {% if 'reports' in request.endpoint %}active{% endif %}">
            <i data-feather="bar-chart-2"></i>
            <span class="text-sm font-medium">Reports</span>
          </a>
        </li>
        {% endif %}

        <!-- Admin only -->
        {% if session.role == 'admin' %}
        <li>
          <a href="/settings" class="nav-link {% if 'settings' in request.endpoint %}active{% endif %}">
          <i data-feather="settings"></i>
          <span class="text-sm font-medium">Settings</span>
          </a>
        </li>
        {% endif %}

        <li class="pt-2 mt-2 border-t border-gray-200">
          <a href="/auth/logout" class="nav-link text-red-600 hover:bg-red-50">
            <i data-feather="log-out"></i>
            <span class="text-sm font-medium">Logout</span>
          </a>
        </li>

      </ul>
    </nav>
  </aside>

  <div class="flex-1 flex flex-col overflow-auto">

    <header class="hidden lg:flex items-center justify-between bg-white border-b border-gray-200 px-6 py-4 shadow-sm">
      <div>
        <h1 class="text-xl font-bold text-gray-900">{% block page_title %}Dashboard{% endblock %}</h1>
        <!-- Breadcrumbs -->
        <nav class="flex items-center gap-2 text-sm text-gray-500 mt-1">
          <a href="/dashboard" class="hover:text-indigo-600 transition-colors">Home</a>
          <span>/</span>
          <span class="text-gray-900">{% block breadcrumb %}Dashboard{% endblock %}</span>
        </nav>
      </div>
      
      <!-- User info -->
      <div class="flex items-center gap-3">
        <div class="text-right">
          <div class="text-sm font-semibold text-gray-900">{{ session.get('full_name', 'User') }}</div>
          <div class="text-xs text-gray-500 flex items-center justify-end gap-1.5">
            <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>
            {{ session.get('role', 'employee').title() }}
          </div>
        </div>
        <div class="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center text-white text-sm font-semibold shadow-sm">
          {{ session.get('full_name', 'U')[0] }}
        </div>
      </div>
    </header>

    <main class="p-6 overflow-auto">
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      <div class="space-y-3 mb-6" id="flashMessages">
        {% for category, msg in messages %}
        <div class="flex items-center gap-3 p-4 rounded-lg border {% if category=='error' %}bg-red-50 border-red-200 text-red-800{% else %}bg-green-50 border-green-200 text-green-800{% endif %} animate-slideIn">
          <i class="{% if category=='error' %}fas fa-exclamation-circle{% else %}fas fa-check-circle{% endif %} text-lg"></i>
          <span class="font-medium text-sm">{{ msg }}</span>
        </div>
        {% endfor %}
      </div>
      {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

  </div>
</div>

<script>feather.replace();</script>
<script src="/static/js/modal.js"></script>
<script src="/static/js/ui-enhancements.js"></script>

<!-- Scroll Reveal Animation -->
<script>
  // Intersection Observer for scroll animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('revealed');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe all scroll-reveal elements
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.scroll-reveal').forEach(el => {
      observer.observe(el);
    });
  });
</script>

<!-- Toast & Loading Systems -->
<script src="{{ url_for('static', filename='js/toast.js') }}"></script>
<script src="{{ url_for('static', filename='js/loading.js') }}"></script>

<script>
  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const sidebar = document.getElementById('sidebar');
  
  if (mobileMenuBtn && sidebar) {
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      const isOpen = !sidebar.classList.contains('-translate-x-full');
      mobileMenuBtn.querySelector('i').className = isOpen ? 'fas fa-times text-lg' : 'fas fa-bars text-lg';
    });
    
    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth < 1024 && !sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
        sidebar.classList.add('-translate-x-full');
        mobileMenuBtn.querySelector('i').className = 'fas fa-bars text-lg';
      }
    });
  }
</script>

{% block scripts %}{% endblock %}

</body>
</html>
