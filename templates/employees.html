{% extends "base.html" %}
{% block page_title %}Employees{% endblock %}
{% block content %}

<div class="space-y-6">

  <!-- HEADER -->
  <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold">Employees</h1>
      <p class="text-sm text-gray-500 mt-1">Manage employee records — search, filter, sort, and actions.</p>
    </div>

    <div class="flex items-center gap-3 w-full lg:w-auto">
      <!-- SEARCH -->
      <div class="flex items-center gap-2 bg-white rounded-xl p-2 shadow">
        <input id="globalSearch" type="text" placeholder="Search name, email, phone..."
               class="px-3 py-2 w-64 outline-none" />
        <button id="clearSearch" class="px-3 py-2 text-sm text-gray-500">Clear</button>
      </div>

      <a href="/employees/add" class="bg-blue-600 text-white px-4 py-2 rounded-xl shadow">
        + Add Employee
      </a>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="bg-white p-4 rounded-2xl shadow flex flex-col md:flex-row gap-3 items-center justify-between">

    <div class="flex gap-3 items-center flex-wrap">

      <select id="filterDept" class="p-2 rounded-lg border">
        <option value="">All Departments</option>
        {% for d in departments %}
          <option value="{{ d.id }}"
            {% if request.args.get('department_id') == (d.id|string) %} selected {% endif %}>
            {{ d.name }}
          </option>
        {% endfor %}
      </select>

      <select id="filterEnroll" class="p-2 rounded-lg border">
        <option value="">Enrollment</option>
        <option value="enrolled" {% if request.args.get('enrolled')=='enrolled' %}selected{% endif %}>Enrolled</option>
        <option value="not_enrolled" {% if request.args.get('enrolled')=='not_enrolled' %}selected{% endif %}>Not Enrolled</option>
      </select>

      <select id="sortBy" class="p-2 rounded-lg border">
        <option value="newest"     {% if sort=='newest' %}selected{% endif %}>Newest</option>
        <option value="oldest"     {% if sort=='oldest' %}selected{% endif %}>Oldest</option>
        <option value="name_asc"   {% if sort=='name_asc' %}selected{% endif %}>Name A–Z</option>
        <option value="name_desc"  {% if sort=='name_desc' %}selected{% endif %}>Name Z–A</option>
      </select>

      <button id="applyFilters" class="px-3 py-2 bg-gray-100 rounded-lg">Apply</button>
      <button id="resetFilters" class="px-3 py-2 text-sm text-gray-500">Reset</button>

    </div>

    <div class="flex items-center gap-3">
      <div class="text-sm text-gray-500">Selected: <span id="selectedCount">0</span></div>
      <button id="bulkDeleteBtn" class="px-3 py-2 bg-red-600 text-white rounded-lg disabled:opacity-50" disabled>
        Delete Selected
      </button>
    </div>

  </div>

  <!-- TABLE -->
  <div class="bg-white p-4 rounded-2xl shadow overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="text-left text-gray-500 border-b">
        <tr>
          <th class="py-3"><input id="selectAll" type="checkbox"></th>
          <th class="py-3">Photo</th>
          <th class="py-3">Name</th>
          <th class="py-3">Email</th>
          <th class="py-3">Department</th>
          <th class="py-3">Phone</th>
          <th class="py-3">Join Date</th>
          <th class="py-3">Enrollment</th>
          <th class="py-3">Actions</th>
        </tr>
      </thead>

      <tbody id="employeesTbody">
        {% for emp in employees %}
        <tr class="border-b hover:bg-gray-50">

          <td class="py-3">
            <input class="rowCheckbox" type="checkbox" value="{{ emp.id }}">
          </td>

          <td class="py-2">
            {% set emp_photo_path = emp.photo_path %}
            {% if emp_photo_path and not emp_photo_path.startswith('/') %}
              {% set emp_photo_path = '/' ~ emp_photo_path %}
            {% endif %}
            <img src="{{ emp_photo_path if emp_photo_path else url_for('static', filename='default_user.png') }}"
                 class="w-10 h-10 rounded-full object-cover">
          </td>

          <td class="py-3 font-medium">{{ emp.full_name }}</td>
          <td class="py-3 text-gray-600">{{ emp.email }}</td>
          <td class="py-3">{{ emp.department or '-' }}</td>
          <td class="py-3">{{ emp.phone or '-' }}</td>
          <td class="py-3">{{ emp.join_date or '-' }}</td>

          <td class="py-3">
            {% if emp.enrolled %}
              <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs">Enrolled</span>
            {% else %}
              <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">Not Enrolled</span>
            {% endif %}
          </td>

          <td class="py-3 space-x-2">
            <a href="/employees/view/{{ emp.id }}" class="text-blue-600 hover:underline">View</a>
            <a href="/employees/edit/{{ emp.id }}" class="text-green-600 hover:underline">Edit</a>
            <button onclick="deleteSingle({{ emp.id }})" class="text-red-600 hover:underline">Delete</button>
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  <div class="flex items-center justify-between">
    <div class="text-sm text-gray-500">
      Showing {{ start + 1 }} – {{ (end if end < total else total) }} of {{ total }} employees
    </div>

    <div class="flex items-center gap-2">

      {% if page > 1 %}
        <a href="?page={{ page - 1 }}&{{ querystring }}" class="px-3 py-2 border rounded-lg">Prev</a>
      {% endif %}

      <div class="px-3 py-2">{{ page }}</div>

      {% if end < total %}
        <a href="?page={{ page + 1 }}&{{ querystring }}" class="px-3 py-2 border rounded-lg">Next</a>
      {% endif %}

    </div>
  </div>

</div>

<script src="/static/js/employees.js"></script>

{% endblock %}
