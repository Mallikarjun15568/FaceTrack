{% extends "base.html" %}
{% block page_title %}Employees{% endblock %}
{% block content %}

<div class="max-w-7xl mx-auto">

  <!-- HEADER -->
  <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Employees</h1>
      <p class="text-sm text-gray-500 mt-1">Manage employee records and access</p>
    </div>

    <div class="flex items-center gap-3 w-full lg:w-auto">
      <!-- SEARCH -->
      <div class="flex items-center gap-2 bg-white border border-gray-300 rounded-lg px-3 py-2 flex-1 lg:w-80">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input id="globalSearch" type="text" placeholder="Search employees..."
               class="flex-1 outline-none text-sm bg-transparent" />
        <button id="clearSearch" class="text-gray-400 hover:text-gray-700">
          <i class="fas fa-times text-sm"></i>
        </button>
      </div>

      <a href="/employees/add" class="btn btn-primary whitespace-nowrap">
        <i class="fas fa-plus"></i>Add Employee
      </a>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="card mb-8 flex flex-col md:flex-row gap-4 items-center justify-between">

    <div class="flex gap-3 items-center flex-wrap">

      <select id="filterDept" class="input-premium text-sm">
        <option value="">All Departments</option>
        {% for d in departments %}
          <option value="{{ d.id }}"
            {% if request.args.get('department_id') == (d.id|string) %} selected {% endif %}>
            {{ d.name }}
          </option>
        {% endfor %}
      </select>

      <select id="filterEnroll" class="input-premium text-sm">
        <option value="">Enrollment Status</option>
        <option value="enrolled" {% if request.args.get('enrolled')=='enrolled' %}selected{% endif %}>Enrolled</option>
        <option value="not_enrolled" {% if request.args.get('enrolled')=='not_enrolled' %}selected{% endif %}>Not Enrolled</option>
      </select>

      <select id="sortBy" class="input-premium text-sm">
        <option value="newest"     {% if sort=='newest' %}selected{% endif %}>Newest First</option>
        <option value="oldest"     {% if sort=='oldest' %}selected{% endif %}>Oldest First</option>
        <option value="name_asc"   {% if sort=='name_asc' %}selected{% endif %}>Name A–Z</option>
        <option value="name_desc"  {% if sort=='name_desc' %}selected{% endif %}>Name Z–A</option>
      </select>

      <button id="applyFilters" class="btn btn-primary">
        <i class="fas fa-filter"></i>Apply
      </button>
      <button id="resetFilters" class="btn btn-secondary">
        <i class="fas fa-redo"></i>Reset
      </button>

    </div>

    <div class="flex items-center gap-4">
      <div class="text-sm font-medium text-gray-700">Selected: <span id="selectedCount" class="font-bold text-indigo-600">0</span></div>
      <button id="bulkDeleteBtn" class="btn btn-danger" disabled>
        <i class="fas fa-trash"></i>Delete Selected
      </button>
    </div>

  </div>

  <!-- TABLE -->
  <div class="card overflow-x-auto">
    <table class="table w-full">
      <thead>
        <tr>
          <th class="rounded-tl-lg"><input id="selectAll" type="checkbox" class="rounded"></th>
          <th>Photo</th>
          <th>Name</th>
          <th>Email</th>
          <th>Department</th>
          <th>Phone</th>
          <th>Join Date</th>
          <th>Enrollment</th>
          <th class="rounded-tr-lg">Actions</th>
        </tr>
      </thead>

      <tbody id="employeesTbody">
        {% for emp in employees %}
        <tr>

          <td>
            <input class="rowCheckbox rounded" type="checkbox" value="{{ emp.id }}">
          </td>

          <td>
            {% set emp_photo_path = emp.photo_path %}
            {% if emp_photo_path and not emp_photo_path.startswith('/') %}
              {% set emp_photo_path = '/' ~ emp_photo_path %}
            {% endif %}
            <img src="{{ emp_photo_path if emp_photo_path else url_for('static', filename='default_user.png') }}"
                 class="w-12 h-12 rounded-lg object-cover border-2 border-gray-200">
          </td>

          <td class="font-semibold text-gray-900">{{ emp.full_name }}</td>
          <td class="text-gray-600">{{ emp.email }}</td>
          <td class="text-gray-700">{{ emp.department or '-' }}</td>
          <td class="text-gray-600">{{ emp.phone or '-' }}</td>
          <td class="text-gray-600">{{ emp.join_date or '-' }}</td>

          <td>
            {% if emp.enrolled %}
              <span class="badge badge-success">✓ Enrolled</span>
            {% else %}
              <span class="badge badge-secondary">Not Enrolled</span>
            {% endif %}
          </td>

          <td class="flex gap-2">
            <a href="/employees/view/{{ emp.id }}" class="text-indigo-600 hover:text-indigo-700 font-medium">View</a>
            <a href="/employees/edit/{{ emp.id }}" class="text-green-600 hover:text-green-700 font-medium">Edit</a>
            <button onclick="deleteSingle({{ emp.id }})" class="text-red-600 hover:text-red-700 font-medium">Delete</button>
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  <div class="flex items-center justify-between card">
    <div class="text-sm text-gray-600">
      Showing <span class="text-indigo-600 font-bold">{{ start + 1 }}</span> – <span class="text-indigo-600 font-bold">{{ (end if end < total else total) }}</span> of <span class="text-indigo-600 font-bold">{{ total }}</span> employees
    </div>

    <div class="flex items-center gap-2">

      {% if page > 1 %}
        <a href="?page={{ page - 1 }}&{{ querystring }}" class="btn btn-secondary">← Prev</a>
      {% endif %}

      <div class="px-4 py-2 bg-indigo-50 text-indigo-600 rounded-lg font-bold">{{ page }}</div>

      {% if end < total %}
        <a href="?page={{ page + 1 }}&{{ querystring }}" class="btn btn-secondary">Next →</a>
      {% endif %}

    </div>
  </div>

</div>

<script src="/static/js/employees.js"></script>

{% endblock %}
