{% extends "base.html" %}
{% block extra_head %}
<meta name="csrf-token" content="{{ csrf_token() }}">
{% endblock %}
{% block content %}

<div class="p-6 space-y-6 max-w-4xl mx-auto">

  <a href="/admin/employees/" class="text-blue-600 hover:underline">&larr; Back to Employees</a>

  <h1 class="text-2xl font-bold">Employee Profile</h1>

  <div class="premium-card p-6 flex flex-col md:flex-row gap-6">

    <!-- PHOTO -->
    <div>
      {% if emp.photo %}
        {% set emp_photo_url = url_for('static', filename=emp.photo) %}
      {% else %}
        {% set emp_photo_url = url_for('static', filename='default_user.png') %}
      {% endif %}
      <img src="{{ emp_photo_url }}"
           class="w-40 h-40 rounded-xl border object-cover">
    </div>

    <!-- DETAILS -->
    <div class="flex-1 space-y-3">
      <h2 class="text-xl font-bold">{{ emp.full_name }}</h2>

      <p><span class="font-semibold">Email:</span> {{ emp.email }}</p>
      <p><span class="font-semibold">Phone:</span> {{ emp.phone or '-' }}</p>
      <p><span class="font-semibold">Gender:</span> {{ emp.gender or '-' }}</p>
      <p><span class="font-semibold">Department:</span> {{ emp.department or '-' }}</p>
      <p><span class="font-semibold">Join Date:</span> {{ emp.join_date or '-' }}</p>

      <p>
        <span class="font-semibold">Enrollment:</span>
        {% if emp.face_embedding %}
          <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs">Enrolled</span>
        {% else %}
          <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">Not Enrolled</span>
        {% endif %}
      </p>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="flex gap-4 pt-2">

    <a href="/admin/employees/edit/{{ emp.id }}"
       class="btn-premium btn-premium-success">
      Edit
    </a>

    <button onclick="deleteEmp({{ emp.id }})"
            class="btn-premium btn-premium-danger">
      Delete
    </button>

    <button onclick="reenrollEmp({{ emp.id }})"
            class="btn-premium btn-premium-primary">
      Re-Enroll Face
    </button>

  </div>
</div>


<!-- JS -->
<script>
function deleteEmp(id) {
    Swal.fire({
        title: "Delete Employee?",
        text: "This action cannot be undone.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Delete"
    }).then((result) => {
        if (!result.isConfirmed) return;
        const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
        if (!csrfToken) {
            Swal.fire("Security error", "CSRF token missing", "error");
            return;
        }
        fetch("/admin/employees/delete/" + id, { 
            method: "POST",
            headers: {
                "X-CSRFToken": csrfToken
            }
        })
        .then(r => r.json())
        .then(res => {
            if (res.success) {
                Swal.fire("Deleted!", "", "success");
                setTimeout(() => window.location.href = "/admin/employees/", 1300);
            }
        });
    });
}

function reenrollEmp(id) {
    window.location.href = "/enroll?emp_id=" + id;
}
</script>

{% endblock %}
