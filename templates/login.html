<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>FaceTrack Pro | Login</title>

  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/professional.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/premium.css') }}">
</head>

<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen flex items-center justify-center px-4 relative overflow-hidden">

  <!-- Animated Background Shapes -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 left-10 w-72 h-72 bg-blue-400/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-400/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
  </div>

  <!-- ================= LOGIN CARD ================= -->
  <div class="premium-card w-full max-w-md relative z-10 animate-fadeInScale p-8">

    <!-- LOGO -->
    <div class="text-center mb-8">
      <div class="flex items-center justify-center mb-4">
        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
          <i class="fas fa-fingerprint text-white text-3xl"></i>
        </div>
      </div>
      <h1 class="text-3xl font-extrabold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
        FaceTrack Pro
      </h1>
      <p class="text-sm text-gray-500 mt-2 font-medium">
        AI-Powered Attendance System
      </p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="space-y-2 mb-6">
      {% for category, msg in messages %}
      <div class="p-4 rounded-xl shadow-sm border-l-4 animate-slideIn {% if category=='error' %}bg-red-50 border-red-500 text-red-700{% else %}bg-green-50 border-green-500 text-green-700{% endif %}">
        <div class="flex items-center gap-3">
          <i class="{% if category=='error' %}fas fa-exclamation-circle{% else %}fas fa-check-circle{% endif %}"></i>
          <span class="font-medium text-sm">{{ msg }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- NORMAL LOGIN FORM -->
    <form method="POST" class="space-y-5">

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
        <input type="text" name="username" required
               class="input-premium">
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
        <input type="password" name="password" required
               class="input-premium">
      </div>
      
      <div class="flex items-center justify-between">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
          <span class="text-sm text-gray-600">Remember me</span>
        </label>
        <a href="#"
          onclick="alert('Please contact system administrator to reset password.')"
          class="text-sm text-blue-600 hover:text-blue-700 font-medium transition-colors">
          Forgot password?
        </a>
      </div>
      
      <button type="submit"
              class="btn-premium btn-premium-primary w-full">
        <i class="fas fa-sign-in-alt"></i>
        Sign In
      </button>

    </form>
    
    <div class="relative my-6">
      <div class="absolute inset-0 flex items-center">
        <div class="w-full border-t border-gray-300"></div>
      </div>
      <div class="relative flex justify-center text-sm">
        <span class="px-4 bg-white text-gray-500 font-medium">Or continue with</span>
      </div>
    </div>

    <!-- FACE ID BUTTON -->
    <button id="loginFaceID"
            type="button"
            class="btn-premium btn-premium-outline w-full group">
      <i class="fas fa-camera text-blue-600 text-xl group-hover:scale-110 transition-transform"></i>
      Login with Face ID
    </button>

    <p class="mt-6 text-center text-sm text-gray-600">
      New user?
      <a href="/auth/signup"
        class="font-semibold text-blue-600 hover:text-blue-700 transition-colors">
        Create account
      </a>
    </p>

  </div>

  <!-- ================= FACE ID MODAL ================= -->
  <div id="faceModal" class="fixed inset-0 z-50 hidden flex items-center justify-center">

    <!-- BACKDROP -->
    <div id="faceBackdrop" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

    <!-- MODAL BOX -->
    <div class="relative z-10 w-full max-w-md bg-white rounded-3xl shadow-2xl p-7 mx-4">

      <div class="text-center mb-4">
        <h3 class="text-2xl font-semibold text-gray-800">Face ID Login</h3>
        <p class="text-sm text-gray-500 mt-1">
          Align your face inside the circle
        </p>
      </div>

      <!-- CAMERA + SCAN -->
      <div class="flex flex-col items-center gap-3">

        <div class="relative w-56 h-56">
          <div class="w-full h-full rounded-full overflow-hidden bg-gray-200">
            <video id="modalFaceCam"
                   autoplay playsinline muted
                   class="w-full h-full object-cover"></video>
          </div>

          <!-- SUCCESS OVERLAY -->
          <div id="faceSuccess"
               class="absolute inset-0 hidden items-center justify-center">
            <div class="w-full h-full rounded-full bg-white/70 flex items-center justify-center">
              <svg class="w-20 h-20 text-green-600"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                      d="M5 13l4 4L19 7"/>
              </svg>
            </div>
          </div>
        </div>

        <div id="modalStatus"
             class="text-sm text-gray-600 min-h-[22px] text-center">
          Initializing cameraâ€¦
        </div>

      </div>

      <!-- ACTIONS -->
      <div class="flex gap-3 mt-5 justify-between">
        <button id="modalCancel"
                class="flex-1 py-2 rounded-xl bg-gray-100 text-gray-700
                       hover:bg-gray-200 transition">
          Cancel
        </button>
        <button id="modalForceCapture"
                class="px-6 py-2 rounded-xl bg-blue-600 text-white font-semibold
                       hover:bg-blue-700 transition">
          Capture
        </button>
      </div>

    </div>
  </div>

  <!-- FACE LOGIN JS -->
  <script src="{{ url_for('static', filename='js/face_login.js') }}"></script>

</body>
</html>
